#!/bin/sh

set -e

# http://www.fifi.org/doc/debconf-doc/tutorial.html
. /usr/share/debconf/confmodule

ENVFILE=/etc/advligorts/env

if [ -e "$ENVFILE" ]; then
    . $ENVFILE || true

    db_set advligorts/site "$SITE"
    db_set advligorts/ifo "$IFO"
fi

for var in site ifo ; do
    template=advligorts/$var
    case $var in
	site) wc=013 ;;
	ifo) wc=012 ;;
    esac
    while true ; do
        db_input high $template || ret=$?
        # return is 30 if the user is not being shown the config, so
        # break
        if [ "$ret" = 30 ] ; then
            break
        fi
	db_go || true

	db_get $template
        val=`echo -n $RET | tr [a-z] [A-Z]`
        wcc=`echo -n $val | wc -lwm | tr -d '[:blank:]'`
	if [ "$wcc" = "$wc" ] ; then
	    db_set $template "$val"
            break
	fi
    done
done

exit 0
