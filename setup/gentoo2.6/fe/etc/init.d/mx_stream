#!/sbin/runscript

opts="${opts}"
sys=`/etc/rt.sh`
hostname=`hostname`
if [ -x "${sys}" ] 
then
	exit 1
fi

# find line number in rtsystab. Use that to define MX card (0-1) and mx_stream slot on card (0-15)
line_num=`grep -v ^# /etc/rtsystab | grep --perl-regexp -n "^${hostname}\s" | sed 's/^\([0-9]*\):.*/\1/g'`
epnum=$(expr $line_num % 16)
cnum=$(expr $line_num / 16)

start() {
	ebegin "Starting mx_stream"
	start-stop-daemon --start --quiet -b -m --pidfile /var/log/mx_stream.pid --exec /opt/rtcds/tst/x2/target/x2daqdc/mx_stream -- -r "$epnum" -W 0 -w 0 -s "$sys" -d x2daqdc:$cnum -l /opt/rtcds/tst/x2/target/x2daqdc/mx_stream_logs/$hostname.log
	eend $?
}

stop() {
	ebegin "Stopping mx_stream"
	start-stop-daemon --stop --quiet --exec /opt/rtcds/tst/x2/target/x2daqdc/mx_stream
	eend $?
}
